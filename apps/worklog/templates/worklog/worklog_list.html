{% extends "base.html" %}

{% block main %}
<br>

<div class="px-3">
	<!-- tabs -->
	<div class="col-12">
		<ul class="nav nav-tabs">
			<li class="nav-item">
				<a class="nav-link" aria-current="page" href="{% url "measurement:list" %}">電流記録</a>
			</li>
			<li class="nav-item">
				<a class="nav-link active" aria-current="page" href="{% url "worklog:list" %}">作業記録</a>
			</li>
		</ul>
	</div>

	<div class="row">
		<!-- table -->
		<div class="col-7">
			<div class="scrollable-container border border-top-0 border-1 rounded-bottom p-3">
				<table class="table text-center">
				<thead class="table-dark">
					<tr>
						<th>作業日時</th>
						<th>ラック番号</th>
						<th>作業区分</th>
						<th>作業内容</th>
						<th>作業者</th>
						<th>編集</th>
						<th>削除</th>
					</tr>
				</thead>
				<tbody>
					{% for worklog in object_list %}
						<tr>
							<td>{{ worklog.work_date }}</td>
							<td>{{ worklog.rack }}</td>
							<td>{{ worklog.get_work_type_display }}</td>
							<td>{{ worklog.description }}</td>
							<td>{{ worklog.employee }}</td>
							<td>
								<a class="btn btn-outline-secondary" 
									href="{% url 'worklog:update' worklog.id %}">編集</a>
							</td>
							<td>
								<button type="button" class="btn btn-outline-secondary delete-btn" 
									worklog-id="{{ worklog.id }}"
									work-date="{{ worklog.work_date }}"
									worklog-rack="{{ worklog.rack }}"
									work-type="{{ worklog.get_work_type_display }}"
									worklog-description="{{ worklog.description }}"
									worklog-employee="{{ worklog.employee }}">
									削除
								</button>
							</td>
						</tr>
					{% endfor %}
				</tbody>
				</table>
			</div>
		</div>

		<!-- forms -->
		<div class="col-5">
			<div class="container border border-top-0 border-1 rounded-bottom">
				<form method="POST">
					{% csrf_token %}
					<!-- work_date -->
					<div class="p-3 col-7">
						<label class="form-label" for="{{ form.work_date.id_for_label }}">記録日時</label>
						<input
							type="{{ form.work_date.field.widget.input_type }}"
							class="form-control"
							{% if form.work_date.field.required %}required{% endif %}
							name="{{ form.work_date.name }}"
							id="{{ form.work_date.id_for_label }}"
							disabled>
					</div>
					
					<!-- work_type -->
					<div class="p-3">
						<label class="form-label">作業区分</label><br>
						{{ form.work_type }}
						<input type="radio" class="btn-check" name="work_type" id="success-outlined" value="installation" autocomplete="off" {% if form.work_type.value == "installation" %}checked{% endif %}disabled>
						<label class="btn btn-outline-primary" for="success-outlined">設置</label>
						
						<input type="radio" class="btn-check" name="work_type" id="danger-outlined" value="removal" autocomplete="off" {% if form.work_type.value == "removal" %}checked{% endif %}disabled>
						<label class="btn btn-outline-primary" for="danger-outlined">撤去</label>

						<input type="radio" class="btn-check" name="work_type" id="check-2-outlined" value="other" autocomplete="off" {% if form.work_type.value == "other" %}checked{% endif %}disabled>
						<label class="btn btn-outline-primary" for="check-2-outlined">その他</label><br>
					</div>
					
					<!-- rack -->
					<div class="p-3 col-4">
						<label class="form-label" for="{{ form.rack.id_for_label }}">ラック番号</label>
						<input
							type="{{ form.rack.field.widget.input_type }}"
							class="form-control"
							{% if form.rack.field.required %}required{% endif %}
							name="{{ form.rack.name }}"
							id="{{ form.rack.id_for_label }}"
							disabled>
					</div>

					<!-- description -->
					<div class="p-3">
						<label class="form-label" for="{{ form.description.id_for_label }}">備考</label>
						<input
							type="{{ form.description.field.widget.input_type }}"
							class="form-control"
							{% if form.description.field.required %}required{% endif %}
							name="{{ form.description.name }}"
							id="{{ form.description.id_for_label }}"
							disabled>
					</div>

					<!-- employee -->
					<div class="p-3 col-7">
						<label class="form-label">作業者</label>
						<input 
							type="{{ form.employee.field.widget.input_type }}" 
							class="form-control"
							disabled>
					</div>
					
					<div class="p-3">
						<button type="submit" class="submit btn btn-primary" disabled>修正</button>
						<a class="submit btn btn-secondary" 
							style="pointer-events: none; cursor: not-allowed;">キャンセル</a>
					</div>
				</form>
			</div>
		</div>
	</div>
</div>


<!-- Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="deleteModalLabel">電流記録の削除</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p><strong>以下の電流記録を本当に削除しますか？</strong></p>
                <p><strong>記録日時:</strong> <span id="work-date"></span></p>
                <p><strong>作業区分:</strong> <span id="work-type"></span></p>
                <p><strong>ラック番号:</strong> <span id="worklog-rack"></span></p>
                <p><strong>備考:</strong> <span id="worklog-description"></span></p>
                <p><strong>作業者:</strong> <span id="worklog-employee"></span></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">キャンセル</button>
                <button type="button" class="btn btn-primary" id="delete-worklog">削除</button>
            </div>
        </div>
    </div>
</div>

<!-- モーダル表示用 javascript-->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // 削除ボタンがクリックされたときの処理
        var deleteButtons = document.querySelectorAll('.delete-btn');
        var deleteModal = new bootstrap.Modal(document.getElementById('deleteModal'));

        deleteButtons.forEach(function (button) {
            button.addEventListener('click', function () {
                var worklogId = this.getAttribute('worklog-id');
                // モーダル表示のための処理
                deleteModal.show();

                // モーダル内の要素に対してCurrentMeasurementの情報を設定
                document.getElementById('work-date').innerText = this.getAttribute('work-date');
                document.getElementById('worklog-rack').innerText = this.getAttribute('worklog-rack');
                document.getElementById('work-type').innerText = this.getAttribute('work-type');
                document.getElementById('worklog-description').innerText = this.getAttribute('worklog-description');
                document.getElementById('worklog-employee').innerText = this.getAttribute('worklog-employee');

                // モーダル内の削除ボタンにデータを設定
                document.getElementById('delete-worklog').setAttribute('worklog-id', worklogId);
            });
        });

        // モーダル内の削除ボタンがクリックされたときの処理
        document.getElementById('delete-worklog').addEventListener('click', function () {
            var worklogId = this.getAttribute('worklog-id');
            // 削除の処理を実行する（削除用のURLにリダイレクト）
            window.location.href = '{% url "worklog:delete" 0 %}'.replace('0', worklogId);
            // モーダルを閉じる
            deleteModal.hide();
        });
    });
</script>

{% endblock %}
