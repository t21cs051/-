{% extends "base.html" %}

{% load static %}

{% block main %}
<script src="{% static canvas.css %}"></script>
<body>
    <h2>電力使用状況閲覧</h2>

        <div class="chart-container" style="position: relative; width: 1000px; height: 300px;">
            <!-- 描画領域 -->
            <canvas id="myChart" height="100px"></canvas>
        </div>

    <script src="{% static 'chart_js/dist/chart.umd.js' %}"></script>
    <script src="{% static 'moment\min\moment-with-locales.js' %}"></script>
    <script src="{% static 'moment/dist/locale/ja.js' %}"></script>
    <script src="{% static 'chartjs-adapter-moment/dist/chartjs-adapter-moment.js' %}"></script>

    <script>
        const lineChartCtx = document.getElementById('myChart').getContext('2d');

        const lineChartData = {
            datasets: [
            {
                label: 'current_value',
                data : [
                {% for item in data %}
                    {x: '{{ item.x }}', y: {{ item.y }}},
                    {% endfor %}
                    ],
                }
                ]
            };

        const myChart = new Chart((() => {
            return document.getElementById('myChart').getContext('2d');
        })(), {
            type: 'line',
            data: lineChartData,
            options: {
                plugins: {
                    legend: {
                        display: false
                    }
                },
                responsive: true, // コンテナのサイズ変更に対応したサイズ変更
                maintainAspectRatio: false, // サイズ変更時に元の縦横比を維持しない
                scales: {
                    x: {
                        scaleLabel: {
                            display: true,
                        },
                        type: 'time',
                        // min: new Date('2023-01-01T00:00:00'),
                        // max: new Date('2023-12-31T23:59:59'),
                        time: {
                            parser: 'YYYY-MM-DDTHH:mm:ss.SSSSSSZ',
                            unit: 'day',
                            stepSize: 1,
                            displayFormats: {
                                'day': 'MM月DD日'
                            }
                        }
                    },
                    y: {
                        beginAtZero: true // y軸は常に0開始
                    },
                }
            }
        });
    </script>

</body>
{% endblock %}
